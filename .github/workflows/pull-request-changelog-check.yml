# **what?**
# Checks that a file has been committed under the /.changes directory
# as a new CHANGELOG entry.  Cannot check for a specific filename as
# it is dynamically generated by change type and timestamp.
# This workflow should not require any secrets since it runs for PRs
# from forked repos.
# By default, secrets are not passed to workflows running from
# a forked repo.
#
# **why?**
# Ensure code changes are reflected in the CHANGELOG.
#
# **when?**
# This will run for all PRs going into main and *.latest. It will run when:
# - the PR is opened or reopened
# - labels are updated on the PR
# - new code is pushed to the branch
# The action will get skipped if the 'Skip Changelog' label is present.
name: "Changelog check"

on:
    pull_request:
        types:
        -   opened
        -   reopened
        -   labeled
        -   unlabeled
        -   synchronize

defaults:
    run:
        shell: bash

permissions:
    contents: read
    pull-requests: write

jobs:
    changelog:
        uses: dbt-labs/actions/.github/workflows/changelog-existence.yml@main
        with:
            changelog_comment: "Thank you for your pull request! We could not find a changelog entry for this change. For details on how to document a change, see the [dbt-redshift contributing guide](https://github.com/dbt-labs/dbt-redshift/blob/main/CONTRIBUTING.md)."
            skip_label: "Skip Changelog"
        secrets: inherit
